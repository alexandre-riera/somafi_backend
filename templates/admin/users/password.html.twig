{% extends 'base.html.twig' %}

{% block title %}Changer le mot de passe - {{ user.fullName }}{% endblock %}

{% block stylesheets %}
{{ parent() }}
<style>
    .form-header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 1.5rem 0;
        margin-bottom: 2rem;
    }

    .form-header h1 {
        margin: 0;
        font-size: 1.75rem;
        font-weight: 700;
    }

    .form-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .user-info {
        background: #f8f9fa;
        border-radius: 6px;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }

    .user-info .name {
        font-weight: 700;
        font-size: 1.1rem;
    }

    .user-info .email {
        color: #666;
        font-size: 0.9rem;
    }

    .error-list {
        background: #fef2f2;
        border: 1px solid #fecaca;
        border-radius: 8px;
        padding: 1rem 1.5rem;
        margin-bottom: 1.5rem;
    }

    .error-list ul {
        margin: 0;
        padding-left: 1.25rem;
    }

    .error-list li {
        color: #dc2626;
        font-size: 0.9rem;
    }

    .password-strength {
        height: 4px;
        border-radius: 2px;
        background: #e9ecef;
        margin-top: 0.5rem;
        overflow: hidden;
    }

    .password-strength-bar {
        height: 100%;
        border-radius: 2px;
        transition: width 0.3s, background 0.3s;
        width: 0;
    }
</style>
{% endblock %}

{% block body %}
<div class="form-header">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center">
            <h1>Changer le mot de passe</h1>
            <a href="{{ path('admin_users') }}" class="btn btn-outline-light btn-sm">‚Üê Retour √† la liste</a>
        </div>
    </div>
</div>

<div class="container" style="max-width: 500px;">
    {# Erreurs #}
    {% if errors|length > 0 %}
    <div class="error-list">
        <strong>Erreurs :</strong>
        <ul>
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <div class="form-card">
        {# Info utilisateur #}
        <div class="user-info">
            <div class="name">{{ user.fullName }}</div>
            <div class="email">{{ user.email }}</div>
        </div>

        <form method="post" action="{{ path('admin_users_password', {id: user.id}) }}">
            <input type="hidden" name="_token" value="{{ csrf_token('user_password_' ~ user.id) }}">

            <div class="mb-3">
                <label for="new_password" class="form-label">Nouveau mot de passe *</label>
                <input type="password" class="form-control" id="new_password" name="new_password"
                       minlength="8" required autocomplete="new-password">
                <div class="password-strength">
                    <div class="password-strength-bar" id="strengthBar"></div>
                </div>
                <small class="text-muted">Minimum 8 caract√®res</small>
            </div>

            <div class="mb-4">
                <label for="confirm_password" class="form-label">Confirmer le mot de passe *</label>
                <input type="password" class="form-control" id="confirm_password" name="confirm_password"
                       minlength="8" required autocomplete="new-password">
                <small class="text-muted" id="matchHint"></small>
            </div>

            <div class="d-flex justify-content-between">
                <a href="{{ path('admin_users') }}" class="btn btn-outline-secondary">Annuler</a>
                <button type="submit" class="btn btn-warning">üîë Changer le mot de passe</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('new_password');
    const confirmInput = document.getElementById('confirm_password');
    const strengthBar = document.getElementById('strengthBar');
    const matchHint = document.getElementById('matchHint');

    // Indicateur de force du mot de passe
    passwordInput.addEventListener('input', function() {
        const val = this.value;
        let strength = 0;
        if (val.length >= 8) strength++;
        if (val.length >= 12) strength++;
        if (/[A-Z]/.test(val)) strength++;
        if (/[0-9]/.test(val)) strength++;
        if (/[^A-Za-z0-9]/.test(val)) strength++;

        const percent = Math.min(strength / 5 * 100, 100);
        const colors = ['#ef4444', '#f59e0b', '#f59e0b', '#22c55e', '#22c55e'];
        strengthBar.style.width = percent + '%';
        strengthBar.style.background = colors[Math.min(strength, 4)] || '#e9ecef';
    });

    // V√©rification correspondance
    confirmInput.addEventListener('input', function() {
        if (this.value && passwordInput.value) {
            if (this.value === passwordInput.value) {
                matchHint.textContent = '‚úÖ Les mots de passe correspondent';
                matchHint.style.color = '#22c55e';
            } else {
                matchHint.textContent = '‚ùå Les mots de passe ne correspondent pas';
                matchHint.style.color = '#ef4444';
            }
        } else {
            matchHint.textContent = '';
        }
    });
});
</script>
{% endblock %}
